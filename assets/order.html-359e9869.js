import{_ as a,M as s,p as e,q as o,N as c,a1 as t}from"./framework-8cd5abc2.js";const i={},p=t(`<h1 id="运行流程" tabindex="-1"><a class="header-anchor" href="#运行流程" aria-hidden="true">#</a> 运行流程</h1><h2 id="仪表盘启动流程" tabindex="-1"><a class="header-anchor" href="#仪表盘启动流程" aria-hidden="true">#</a> 仪表盘启动流程</h2><p>这个流程中的各种 <code>管理器</code> , <code>服务</code> , 源代码均在 <code>KitX Dashboard/Services/</code> 下</p><ol><li>初始化事件总线 (<code>EventHandlers</code>)</li><li>处理启动参数 (即命令行参数)</li><li>单进程检查 (防止多个实例同时运行)</li><li>启动时检查 <ol><li>读取配置文件, 初始化配置信息 (存在则读取, 不存在则初始化默认配置)</li><li>初始化日志系统, 开始记录日志</li><li>初始化全局异常捕获</li><li>初始化相关环境 (存在则读取, 不存在则重新创建) <ol><li>Common.Algorithm</li></ol></li><li>初始化数据库 (存在则读取, 不存在则重新创建)</li><li>初始化任务管理器 (<code>TasksManager</code>)</li><li>初始化网络管理器 (<code>WebManager</code>)</li><li>初始化数据记录管理器 (<code>StatisticsManager</code>)</li><li>初始化有关事件 (<code>EventHandlers</code>)</li><li>初始化文件监控管理器 (<code>FileWatcherManager</code>)</li></ol></li><li>进入应用生命周期, 启动图形化界面</li></ol><h2 id="网络初始化过程" tabindex="-1"><a class="header-anchor" href="#网络初始化过程" aria-hidden="true">#</a> 网络初始化过程</h2><ul><li>在 <code>仪表盘启动流程</code> 的 4.7 步中, 实际执行的代码是:<div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>  <span class="token preprocessor property">#<span class="token directive keyword">region</span> 初始化 </span><span class="token return-type class-name">WebManager</span>

  Program<span class="token punctuation">.</span>TasksManager<span class="token punctuation">.</span><span class="token function">SignalRun</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>SignalsNames<span class="token punctuation">.</span>MainWindowInitSignal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token punctuation">{</span>
          Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>Program<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>DelayStartSeconds <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Program<span class="token punctuation">.</span>WebManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>这个任务将在 <code>MainWindow.xaml.cs</code> 中 <code>InitWindow()</code> 函数执行完毕时 <code>Raise</code><br> 并且休眠 <code>Program.Config.Web.DelayStartSeconds</code> 秒数后再开始启动网络相关服务</li><li><code>WebManager.Start()</code> 方法将分别初始化 <code>DevicesManager</code> , <code>DevicesServer</code> , <code>PluginsManager</code> 和 <code>PluginsServer</code></li><li><code>DevicesServer</code> 在调用 <code>Start()</code> 方法后开始向局域网多播本机的设备信息 udp 包, 表现形式为 <code>DeviceInfoStruct</code> 的 json 序列化字符串 (该结构定义于 <code>KitX.Web.Rules</code> 中)<br> 同时也会监听来自局域网组播的 udp 包, 并将其解析为 <code>DeviceInfoStruct</code> 结构, 并通过 <code>DevicesManager.Update(DeviceInfoStruct)</code> 方法将其添加到界面中</li><li><code>PluginsServer</code> 在调用 <code>Start()</code> 方法后开始监听网络连接请求并同请求的插件建立 tcp 连接, 接收到以 <code>&quot;PluginStruct: &quot;</code> 打头的报文之后将剩余部分作为 json 字符串反序列化为 <code>PluginStruct</code> 结构, 并通过 <code>PluginsManager.Execute(string, IPEndPoint)</code> 方法将其添加到界面中</li></ul><h2 id="自组网流程" tabindex="-1"><a class="header-anchor" href="#自组网流程" aria-hidden="true">#</a> 自组网流程</h2><p>基于局域网中不断发送的 udp 设备报文, KitX Dashboard 可以很轻松地判断出局域网中运行着 KitX Dashboard 的设备</p><p>在 udp 设备报文中增加 tcp 服务器相关字段, 即可依据 udp 设备报文自动建立连接, 组成网络</p><p>具体流程: (以某个设备的视角观察)</p>`,10);function l(r,d){const n=s("FlowChart");return e(),o("div",null,[p,c(n,{id:"flowchart-136",code:"eJxtUE1Lw0AQve+vyLGCSUiOgay/JSbTdCXuLptJg5BDj0ItLRRE0CKCqJfi3Q/8M27an+FsFPHg5cGbN2/ezNSY8hozg4ln32b2cc4g5SCLxNu9rvvNLVM6SrnSYDIUSiZev158vt9Enc5qJDH+R4y7vDEGJLK6OSY3oVENCgkUsl3tnub2ZdkJOc0qUbBcySLlDsXPkKvn0K4ejrpMa6OmUCR8gqiTMGzbNiiVKisIcnXKcgr/47Pn9/3lNu4MnECOUDChUi6kbpDCCRNv/3G9v7uwy0U/2wRB0I0bbAwwVqNPV0QjI8oJHvjD0GGv0RnUh95vOf4uSkXEnTaqYOwE8tIyrpmIUD4HR4c2+pCjX0hZjw4=",preset:"vue"})])}const k=a(i,[["render",l],["__file","order.html.vue"]]);export{k as default};
